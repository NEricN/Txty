<html>
<head>
    <style>
        #repl {
            overflow-y: scroll;
            background: #f7f7f7; /* Old browsers */
            background: linear-gradient(to bottom,  #f7f7f7 0%,#efefef 100%); /* W3C */
        }

        hr {
            border-color: #4c4c4c;
        }




        button {
            font-size: 20px;

            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;

            border: none;

            border-top: 1px solid #ffffff;
            background: #006eb3;
            background: -webkit-gradient(linear, left top, left bottom, from(#00aeff), to(#006eb3));
            background: -webkit-linear-gradient(top, #00aeff, #006eb3);
            padding: 4px 8px;
            box-shadow: rgba(0,0,0,1) 0 1px 0;
            text-shadow: rgba(0,0,0,.4) 0 1px 0;
            color: #ffffff;
            //font-size: 24px;
            //font-family: Georgia, san-serif;
            text-decoration: none;
            vertical-align: middle;


       }

        button:hover {
        border-top-color: #2c5673;
        background: #2c5673;
        color: #000000;
        }
        button:active {
        border-top-color: #0076c4;
        background: #0076c4;
        }

        .defaults {
            width: 100%;
            overflow-x: hidden;
        }

        .dark-background {
            background-color: #2c2c2c;
        }
        .borderless {
        border: 0;
        outline: none;
        outline-offset: 0;
        }

        .transparent {
            background-color: transparent;
        }

        .row {
            overflow-x: scroll;
            white-space: nowrap;
            width: 100%;
        }

        .middle {
            text-align: center;
        }

        .right {
            right: 0%;
            float: right;
        }

        .large-button {
            width: 33%;
            font-size: 25px;
        }

        .medium-button {
            width: calc(50% - 180px);
            min-width: 60px;
            font-size: 25px;
        }
    </style>
</head>
<body class="dark-background">
<div id="repl" class="repl">
    <div id="past-input">

    </div>
    <div>
    <textarea id="input" class="borderless transparent" rows="20" cols="60">&gt;</textarea>
    </div>
</div>
</div>
<div class="defaults transparent" id="keyboard">
    <div>

    </div>
    <hr />
    <div class="row">
        <button onclick="appendToPrompt('+')">+</button>
        <button onclick="appendToPrompt('-')">-</button>
        <button onclick="appendToPrompt('*')">*</button>
        <button onclick="appendToPrompt('**')">**</button>
        <button onclick="appendToPrompt('%')">%</button>

        <button onclick="appendToPrompt('==')">==</button>
        <button onclick="appendToPrompt('!=')">!=</button>
        <button onclick="appendToPrompt('<')">&lt;</button>
        <button onclick="appendToPrompt('>')">&gt;</button>
        <button onclick="appendToPrompt('>=')">&ge;</button>
        <button onclick="appendToPrompt('<=')">&le;</button>

        <button onclick="appendToPrompt('~')">~</button>
        <button onclick="appendToPrompt('|')">|</button>
        <button onclick="appendToPrompt('&')">&</button>
        <button onclick="appendToPrompt('^')">^</button>
        <button onclick="appendToPrompt('<<')">&lt;&lt;</button>
        <button onclick="appendToPrompt('>>')">&gt;&gt;</button>
    </div>
    <hr />
    <div id="functions" class="row">
        <button onclick="appendToPrompt('def ')">def</button>
        <button onclick="appendBracket('map(', '(')"" id="map">map</button>
        <button onclick="appendBracket('filter(', '(')">filter</button>
        <button onclick="appendBracket('reduce(', '(')"">reduce</button>
        <button onclick="appendToPrompt('print ')">print</button>
    </div>
    <hr />
    <div id="variables" class="row">
        <button onclick="appendToPrompt('=')">=</button>
        <button onclick="appendToPrompt('x')">x</button>
        <button onclick="appendToPrompt('y')">y</button>
        <button onclick="appendToPrompt('z')">z</button>
        <button onclick="appendToPrompt('i')">i</button>
        <button onclick="appendToPrompt('j')">j</button>
        <button onclick="appendToPrompt('k')">k</button>
    </div>
    <hr />
    <div class="row">
        <button onclick="appendToPrompt(', ')">,</button>
        <button onclick="appendToPrompt('lambda ')">&#955;</button>
        <button onclick="appendBracket('[', '[')">[</button>
        <button onclick="appendBracket('{', '{')">{</button>
        <button onclick="appendBracket('(', '(')">(</button>
        <button onclick="appendBracket('|', '|')">|</button>
        <button onclick="popBracket()">]}|)</button>
        <button onclick="appendToPrompt('if ')">if</button>
        <button onclick="appendToPrompt('do ')">do</button>
        <button onclick="appendToPrompt('else ')">else</button>
        <button onclick="appendToPrompt('end')">end</button>
        <button onclick="appendToPrompt('return ')">return</button>
    </div>
    <hr />
    <div class="row" style="text-align: center">
        <button onclick="appendToPrompt('    ')" class="medium-button">Tab</button>
        <button onclick="appendToPrompt('0')">0</button>
        <button onclick="appendToPrompt('1')">1</button>
        <button onclick="appendToPrompt('2')">2</button>
        <button onclick="appendToPrompt('3')">3</button>
        <button onclick="appendToPrompt('4')">4</button>
        <button onclick="appendToPrompt('5')">5</button>
        <button onclick="appendToPrompt('6')">6</button>
        <button onclick="appendToPrompt('7')">7</button>
        <button onclick="appendToPrompt('8')">8</button>
        <button onclick="appendToPrompt('9')">9</button>
        <button onclick="backSpace()" class="medium-button">Back</button>
    </div>
    <hr />
    <div class="row">
        <button class="large-button" onclick="appendToPrompt('\n')">New Line</button>
        <button class="large-button" onclick="appendToPrompt(' ')">Space</button>
        <button class="large-button" onclick="flushLine()">Run</button>
    </div>
</div>
</div>
<script type="text/javascript">
            var repl = document.getElementById("repl");
            var keyboard = document.getElementById("keyboard");

            repl.style.height = (document.body.scrollHeight - keyboard.scrollHeight - 20) + "px";

            var variables = ['x', 'y', 'z', 'i', 'j', 'k'];
            var functions = ['map', 'filter', 'reduce'];
            var currentBrackets = [];
            var brackets = {
                '{':'}',
                '|':'|',
                '(':')',
                '<':'>',
                '[':']'
            }

            function backSpace() {
                var temp = document.getElementById("input");

                if(temp.value.length > 1) {
                    var tempChar = temp.value[temp.value.length-1];
                    temp.value = temp.value.substr(0, temp.value.length - 1);
                }
            }

            function popBracket() {
                if(currentBrackets.length) {
                    appendToPrompt(currentBrackets.pop());
                }
            }

            function appendBracket(txt, bracket) {
                currentBrackets.push(brackets[bracket]);
                appendToPrompt(txt);
            }

            function appendToPrompt(string) {
                document.getElementById("input").value += string;
            }

            function removeChar() {
                var temp = document.getElementById("input").value.pop();

                if(brackets[temp]){
                    currentBrackets.pop();
                }
            }

            function addFunction(func) {
                if(functions.indexOf(func) == -1) {
                    functions.push(func);
                    var funcArr = document.getElementById("functions");
                    funcArr.innerHTML += "<button onclick=\"appendToPrompt('"+ func + " ')\">" + func + "</button>";
                }
            }

            function addVariable(vari) {
                if(variables.indexOf(vari) == -1) {
                    variables.push(vari);
                    var varArr = document.getElementById("variables");
                    varArr.innerHTML += "<button onclick=\"appendToPrompt('"+ vari + "')\">" + vari + "</button>";
                }
            }

            //dom manip funcs

            function flushLine() {
                var inputElem = document.getElementById("input");

                var temp = inputElem.value.match(/def\s*[^\n\r\(\s]+[\n\r\(][\s\S]*end/g);
                if(temp) {
                    temp.forEach(function(x) {
                        addFunction(x.match(/def\s*([^\n\r\(\s]+)[\(\n\r][\s\S]*end/)[1]);
                    });
                }

                temp = inputElem.value.match(/[A-Za-z][A-Za-z0-9_]*\s*=\s*.+/g);
                console.log(temp);
                if(temp) {
                    temp.forEach(function(x) {
                        addVariable(x.match(/([A-Za-z][A-Za-z0-9_]*)\s*=\s*.+/)[1]);
                    });
                }

                addLine(inputElem.value.split(/\r?\n/).map(function(x) {
                    return x[0] != ">" ? ">" + x : x;
                }).join("<br />"));

                try{
                    window.jsinterface.runCode(inputElem.value.substr(1));
                } catch(err) {
                    //addLine(err.message);
                    //addLine(JSON.stringify(window.jsinterface));
                }

                inputElem.value = ">";
            }
            function printShit(string) {
                document.getElementById("repl").innerHTML = "<p>&gt;" + "Stuff should be written" + "</p>";
                document.getElementById("repl").innerHTML = "<p>&gt;" + string + "</p>";
            }
            function addLine(string) {
                document.getElementById("past-input").innerHTML += string + "<br />";
            }
    </script>
</body>
</html>